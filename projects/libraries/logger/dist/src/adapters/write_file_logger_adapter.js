"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logger_adapter_1 = require("./logger_adapter");
const fs = require("fs");
const timers_1 = require("timers");
class WriteFileLoggerAdapter extends logger_adapter_1.LoggerAdapter {
    constructor(path) {
        super();
        this.path = path;
        this.bufferedLogLines = [];
    }
    log(log) {
        this.bufferedLogLines.push(this.createLogLine(log));
        if (this.timeOutId) {
            timers_1.clearTimeout(this.timeOutId);
        }
        this.timeOutId = setTimeout(() => {
            fs.appendFile(this.path, this.bufferedLogLines.join(''), () => { });
            this.bufferedLogLines = [];
        }, 50);
    }
    createLogLine(log) {
        return [log.text, JSON.stringify(log.object), '\n'].filter((s) => s).join('');
    }
}
exports.WriteFileLoggerAdapter = WriteFileLoggerAdapter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndyaXRlX2ZpbGVfbG9nZ2VyX2FkYXB0ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IndyaXRlX2ZpbGVfbG9nZ2VyX2FkYXB0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBsb2dnZXJfYWRhcHRlcl8xID0gcmVxdWlyZShcIi4vbG9nZ2VyX2FkYXB0ZXJcIik7XG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbmNvbnN0IHRpbWVyc18xID0gcmVxdWlyZShcInRpbWVyc1wiKTtcbmNsYXNzIFdyaXRlRmlsZUxvZ2dlckFkYXB0ZXIgZXh0ZW5kcyBsb2dnZXJfYWRhcHRlcl8xLkxvZ2dlckFkYXB0ZXIge1xuICAgIGNvbnN0cnVjdG9yKHBhdGgpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5idWZmZXJlZExvZ0xpbmVzID0gW107XG4gICAgfVxuICAgIGxvZyhsb2cpIHtcbiAgICAgICAgdGhpcy5idWZmZXJlZExvZ0xpbmVzLnB1c2godGhpcy5jcmVhdGVMb2dMaW5lKGxvZykpO1xuICAgICAgICBpZiAodGhpcy50aW1lT3V0SWQpIHtcbiAgICAgICAgICAgIHRpbWVyc18xLmNsZWFyVGltZW91dCh0aGlzLnRpbWVPdXRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50aW1lT3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGZzLmFwcGVuZEZpbGUodGhpcy5wYXRoLCB0aGlzLmJ1ZmZlcmVkTG9nTGluZXMuam9pbignJyksICgpID0+IHsgfSk7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlcmVkTG9nTGluZXMgPSBbXTtcbiAgICAgICAgfSwgNTApO1xuICAgIH1cbiAgICBjcmVhdGVMb2dMaW5lKGxvZykge1xuICAgICAgICByZXR1cm4gW2xvZy50ZXh0LCBKU09OLnN0cmluZ2lmeShsb2cub2JqZWN0KSwgJ1xcbiddLmZpbHRlcigocykgPT4gcykuam9pbignJyk7XG4gICAgfVxufVxuZXhwb3J0cy5Xcml0ZUZpbGVMb2dnZXJBZGFwdGVyID0gV3JpdGVGaWxlTG9nZ2VyQWRhcHRlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsZXlKMlpYSnphVzl1SWpvekxDSm1hV3hsSWpvaWQzSnBkR1ZmWm1sc1pWOXNiMmRuWlhKZllXUmhjSFJsY2k1cWN5SXNJbk52ZFhKalpWSnZiM1FpT2lJaUxDSnpiM1Z5WTJWeklqcGJJbmR5YVhSbFgyWnBiR1ZmYkc5bloyVnlYMkZrWVhCMFpYSXVhbk1pWFN3aWJtRnRaWE1pT2x0ZExDSnRZWEJ3YVc1bmN5STZJanM3UVVGQlFTeHhSRUZCYVVRN1FVRkRha1FzZVVKQlFYbENPMEZCUTNwQ0xHMURRVUZ6UXp0QlFVTjBReXhOUVVGaExITkNRVUYxUWl4VFFVRlJMRGhDUVVGaE8wbEJRM0pFTEZsQlFWa3NTVUZCU1R0UlFVTmFMRXRCUVVzc1JVRkJSU3hEUVVGRE8xRkJRMUlzU1VGQlNTeERRVUZETEVsQlFVa3NSMEZCUnl4SlFVRkpMRU5CUVVNN1VVRkRha0lzU1VGQlNTeERRVUZETEdkQ1FVRm5RaXhIUVVGSExFVkJRVVVzUTBGQlF6dEpRVU12UWl4RFFVRkRPMGxCUTBRc1IwRkJSeXhEUVVGRExFZEJRVWM3VVVGRFNDeEpRVUZKTEVOQlFVTXNaMEpCUVdkQ0xFTkJRVU1zU1VGQlNTeERRVUZETEVsQlFVa3NRMEZCUXl4aFFVRmhMRU5CUVVNc1IwRkJSeXhEUVVGRExFTkJRVU1zUTBGQlF6dFJRVU53UkN4SlFVRkpMRWxCUVVrc1EwRkJReXhUUVVGVExFVkJRVVU3V1VGRGFFSXNjVUpCUVZrc1EwRkJReXhKUVVGSkxFTkJRVU1zVTBGQlV5eERRVUZETEVOQlFVTTdVMEZEYUVNN1VVRkRSQ3hKUVVGSkxFTkJRVU1zVTBGQlV5eEhRVUZITEZWQlFWVXNRMEZCUXl4SFFVRkhMRVZCUVVVN1dVRkROMElzUlVGQlJTeERRVUZETEZWQlFWVXNRMEZCUXl4SlFVRkpMRU5CUVVNc1NVRkJTU3hGUVVGRkxFbEJRVWtzUTBGQlF5eG5Ra0ZCWjBJc1EwRkJReXhKUVVGSkxFTkJRVU1zUlVGQlJTeERRVUZETEVWQlFVVXNSMEZCUnl4RlFVRkZMRWRCUVVjc1EwRkJReXhEUVVGRExFTkJRVU03V1VGRGNFVXNTVUZCU1N4RFFVRkRMR2RDUVVGblFpeEhRVUZITEVWQlFVVXNRMEZCUXp0UlFVTXZRaXhEUVVGRExFVkJRVVVzUlVGQlJTeERRVUZETEVOQlFVTTdTVUZEV0N4RFFVRkRPMGxCUTBRc1lVRkJZU3hEUVVGRExFZEJRVWM3VVVGRFlpeFBRVUZQTEVOQlFVTXNSMEZCUnl4RFFVRkRMRWxCUVVrc1JVRkJSU3hKUVVGSkxFTkJRVU1zVTBGQlV5eERRVUZETEVkQlFVY3NRMEZCUXl4TlFVRk5MRU5CUVVNc1JVRkJSU3hKUVVGSkxFTkJRVU1zUTBGQlF5eE5RVUZOTEVOQlFVTXNRMEZCUXl4RFFVRkRMRVZCUVVVc1JVRkJSU3hEUVVGRExFTkJRVU1zUTBGQlF5eERRVUZETEVsQlFVa3NRMEZCUXl4RlFVRkZMRU5CUVVNc1EwRkJRenRKUVVOc1JpeERRVUZETzBOQlEwbzdRVUZ1UWtRc2QwUkJiVUpESW4wPSJdfQ==