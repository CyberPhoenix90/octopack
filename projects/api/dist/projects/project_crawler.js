"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const config_resolver_1 = require("config_resolver");
class ProjectCrawler {
    async findProjects(root, context) {
        const result = [];
        await this.searchDirectory(result, root, context);
        return result;
    }
    async searchDirectory(result, path, context) {
        if (await context.fileSystem.exists(path_1.join(path, config_resolver_1.OCTOPACK_CONFIG_FILE_NAME))) {
            const config = await config_resolver_1.loadConfig(path, context.fileSystem);
            if (config.scope === 'project') {
                result.push({
                    path,
                    rawConfig: config,
                    resolvedConfig: config_resolver_1.resolveConfig({
                        project: config,
                        workspace: context.workspaceConfig
                    })
                });
            }
            else {
                await this.crawSubfolders(context, path, result);
            }
        }
        else {
            await this.crawSubfolders(context, path, result);
        }
    }
    async crawSubfolders(context, path, result) {
        const directories = await context.fileSystem.getSubfolders(path);
        for (const dir of directories) {
            await this.searchDirectory(result, dir, context);
        }
    }
}
exports.ProjectCrawler = ProjectCrawler;
exports.projectCrawler = new ProjectCrawler();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2plY3RfY3Jhd2xlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InByb2plY3RfY3Jhd2xlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IHBhdGhfMSA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuY29uc3QgY29uZmlnX3Jlc29sdmVyXzEgPSByZXF1aXJlKFwiY29uZmlnX3Jlc29sdmVyXCIpO1xuY2xhc3MgUHJvamVjdENyYXdsZXIge1xuICAgIGFzeW5jIGZpbmRQcm9qZWN0cyhyb290LCBjb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgICBhd2FpdCB0aGlzLnNlYXJjaERpcmVjdG9yeShyZXN1bHQsIHJvb3QsIGNvbnRleHQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBhc3luYyBzZWFyY2hEaXJlY3RvcnkocmVzdWx0LCBwYXRoLCBjb250ZXh0KSB7XG4gICAgICAgIGlmIChhd2FpdCBjb250ZXh0LmZpbGVTeXN0ZW0uZXhpc3RzKHBhdGhfMS5qb2luKHBhdGgsIGNvbmZpZ19yZXNvbHZlcl8xLk9DVE9QQUNLX0NPTkZJR19GSUxFX05BTUUpKSkge1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgY29uZmlnX3Jlc29sdmVyXzEubG9hZENvbmZpZyhwYXRoLCBjb250ZXh0LmZpbGVTeXN0ZW0pO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5zY29wZSA9PT0gJ3Byb2plY3QnKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAgICAgICAgICByYXdDb25maWc6IGNvbmZpZyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRDb25maWc6IGNvbmZpZ19yZXNvbHZlcl8xLnJlc29sdmVDb25maWcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogY29uZmlnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlOiBjb250ZXh0LndvcmtzcGFjZUNvbmZpZ1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jcmF3U3ViZm9sZGVycyhjb250ZXh0LCBwYXRoLCByZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jcmF3U3ViZm9sZGVycyhjb250ZXh0LCBwYXRoLCByZXN1bHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGNyYXdTdWJmb2xkZXJzKGNvbnRleHQsIHBhdGgsIHJlc3VsdCkge1xuICAgICAgICBjb25zdCBkaXJlY3RvcmllcyA9IGF3YWl0IGNvbnRleHQuZmlsZVN5c3RlbS5nZXRTdWJmb2xkZXJzKHBhdGgpO1xuICAgICAgICBmb3IgKGNvbnN0IGRpciBvZiBkaXJlY3Rvcmllcykge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZWFyY2hEaXJlY3RvcnkocmVzdWx0LCBkaXIsIGNvbnRleHQpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5Qcm9qZWN0Q3Jhd2xlciA9IFByb2plY3RDcmF3bGVyO1xuZXhwb3J0cy5wcm9qZWN0Q3Jhd2xlciA9IG5ldyBQcm9qZWN0Q3Jhd2xlcigpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxleUoyWlhKemFXOXVJam96TENKbWFXeGxJam9pY0hKdmFtVmpkRjlqY21GM2JHVnlMbXB6SWl3aWMyOTFjbU5sVW05dmRDSTZJaUlzSW5OdmRYSmpaWE1pT2xzaWNISnZhbVZqZEY5amNtRjNiR1Z5TG1weklsMHNJbTVoYldWeklqcGJYU3dpYldGd2NHbHVaM01pT2lJN08wRkJRVUVzSzBKQlFUUkNPMEZCUXpWQ0xIRkVRVUYxUmp0QlFVTjJSaXhOUVVGaExHTkJRV003U1VGRGRrSXNTMEZCU3l4RFFVRkRMRmxCUVZrc1EwRkJReXhKUVVGSkxFVkJRVVVzVDBGQlR6dFJRVU0xUWl4TlFVRk5MRTFCUVUwc1IwRkJSeXhGUVVGRkxFTkJRVU03VVVGRGJFSXNUVUZCVFN4SlFVRkpMRU5CUVVNc1pVRkJaU3hEUVVGRExFMUJRVTBzUlVGQlJTeEpRVUZKTEVWQlFVVXNUMEZCVHl4RFFVRkRMRU5CUVVNN1VVRkRiRVFzVDBGQlR5eE5RVUZOTEVOQlFVTTdTVUZEYkVJc1EwRkJRenRKUVVORUxFdEJRVXNzUTBGQlF5eGxRVUZsTEVOQlFVTXNUVUZCVFN4RlFVRkZMRWxCUVVrc1JVRkJSU3hQUVVGUE8xRkJRM1pETEVsQlFVa3NUVUZCVFN4UFFVRlBMRU5CUVVNc1ZVRkJWU3hEUVVGRExFMUJRVTBzUTBGQlF5eFhRVUZKTEVOQlFVTXNTVUZCU1N4RlFVRkZMREpEUVVGNVFpeERRVUZETEVOQlFVTXNSVUZCUlR0WlFVTjRSU3hOUVVGTkxFMUJRVTBzUjBGQlJ5eE5RVUZOTERSQ1FVRlZMRU5CUVVNc1NVRkJTU3hGUVVGRkxFOUJRVThzUTBGQlF5eFZRVUZWTEVOQlFVTXNRMEZCUXp0WlFVTXhSQ3hKUVVGSkxFMUJRVTBzUTBGQlF5eExRVUZMTEV0QlFVc3NVMEZCVXl4RlFVRkZPMmRDUVVNMVFpeE5RVUZOTEVOQlFVTXNTVUZCU1N4RFFVRkRPMjlDUVVOU0xFbEJRVWs3YjBKQlEwb3NVMEZCVXl4RlFVRkZMRTFCUVUwN2IwSkJRMnBDTEdOQlFXTXNSVUZCUlN3clFrRkJZU3hEUVVGRE8zZENRVU14UWl4UFFVRlBMRVZCUVVVc1RVRkJUVHQzUWtGRFppeFRRVUZUTEVWQlFVVXNUMEZCVHl4RFFVRkRMR1ZCUVdVN2NVSkJRM0pETEVOQlFVTTdhVUpCUTB3c1EwRkJReXhEUVVGRE8yRkJRMDQ3YVVKQlEwazdaMEpCUTBRc1RVRkJUU3hKUVVGSkxFTkJRVU1zWTBGQll5eERRVUZETEU5QlFVOHNSVUZCUlN4SlFVRkpMRVZCUVVVc1RVRkJUU3hEUVVGRExFTkJRVU03WVVGRGNFUTdVMEZEU2p0aFFVTkpPMWxCUTBRc1RVRkJUU3hKUVVGSkxFTkJRVU1zWTBGQll5eERRVUZETEU5QlFVOHNSVUZCUlN4SlFVRkpMRVZCUVVVc1RVRkJUU3hEUVVGRExFTkJRVU03VTBGRGNFUTdTVUZEVEN4RFFVRkRPMGxCUTBRc1MwRkJTeXhEUVVGRExHTkJRV01zUTBGQlF5eFBRVUZQTEVWQlFVVXNTVUZCU1N4RlFVRkZMRTFCUVUwN1VVRkRkRU1zVFVGQlRTeFhRVUZYTEVkQlFVY3NUVUZCVFN4UFFVRlBMRU5CUVVNc1ZVRkJWU3hEUVVGRExHRkJRV0VzUTBGQlF5eEpRVUZKTEVOQlFVTXNRMEZCUXp0UlFVTnFSU3hMUVVGTExFMUJRVTBzUjBGQlJ5eEpRVUZKTEZkQlFWY3NSVUZCUlR0WlFVTXpRaXhOUVVGTkxFbEJRVWtzUTBGQlF5eGxRVUZsTEVOQlFVTXNUVUZCVFN4RlFVRkZMRWRCUVVjc1JVRkJSU3hQUVVGUExFTkJRVU1zUTBGQlF6dFRRVU53UkR0SlFVTk1MRU5CUVVNN1EwRkRTanRCUVdwRFJDeDNRMEZwUTBNN1FVRkRXU3hSUVVGQkxHTkJRV01zUjBGQlJ5eEpRVUZKTEdOQlFXTXNSVUZCUlN4RFFVRkRJbjA9Il19